@model IEnumerable<HRMS.ViewModels.AttendanceIndexVm>

@{
    ViewData["Title"] = "Attendance Records";
    Layout = "~/Views/Shared/_HrLayout.cshtml";

    // Safely get employee list
    List<HRMS.Models.Employee> employees =
        ViewBag.EmployeeList as List<HRMS.Models.Employee>
        ?? new List<HRMS.Models.Employee>();
}

<div class="container py-4">

    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
        <h2 class="fw-bold page-title m-0">
            <i class="fa-solid fa-filter me-2"></i> Attendance Filters
        </h2>
        <small class="text-muted">Total: @((Model?.Count()) ?? 0)</small>
    </div>

    <!-- FILTER FORM -->
    <form method="get" class="row g-3 shadow-sm bg-white p-4 rounded mb-4">

        <!-- Search -->
        <div class="col-12 col-md-6 col-lg-3">
            <label class="form-label fw-semibold">Search</label>
            <input type="text"
                   name="search"
                   class="form-control"
                   value="@ViewBag.Search"
                   placeholder="Employee name or code" />
        </div>

        <!-- From Date -->
        <div class="col-6 col-lg-2">
            <label class="form-label fw-semibold">From Date</label>
            <input type="date"
                   name="fromDate"
                   class="form-control"
                   value="@ViewBag.FromDate" />
        </div>

        <!-- To Date -->
        <div class="col-6 col-lg-2">
            <label class="form-label fw-semibold">To Date</label>
            <input type="date"
                   name="toDate"
                   class="form-control"
                   value="@ViewBag.ToDate" />
        </div>

        <!-- Status -->
        <div class="col-12 col-md-6 col-lg-2">
            <label class="form-label fw-semibold">Status</label>
            <select name="status" class="form-select">
                <option value="All" selected="@(ViewBag.Status == "All")">All</option>
                <option value="Completed" selected="@(ViewBag.Status == "Completed")">Completed</option>
                <option value="NotCheckedOut" selected="@(ViewBag.Status == "NotCheckedOut")">Not Checked Out</option>
            </select>
        </div>

        <!-- Buttons -->
        <div class="col-12 col-lg-3 d-grid d-md-flex align-items-end gap-2">
            <button class="btn btn-primary">
                <i class="fa-solid fa-search me-1"></i> Apply
            </button>

            <button formaction="/Attendance/ExportFiltered"
                    formmethod="get"
                    class="btn btn-success">
                <i class="fa-solid fa-file-excel me-1"></i> Export
            </button>

            <a href="/Attendance/CalendarView" class="btn btn-info text-white">
                <i class="fa-solid fa-calendar-days me-1"></i> View in Calendar
            </a>
        </div>

    </form>

    <!-- TABLE -->
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">

            <div class="table-responsive">
                <table class="table table-bordered table-striped mb-0 align-middle">
                    <thead class="table-dark sticky-top">
                        <tr>
                            <th class="text-nowrap">Employee Code</th>
                            <th class="text-nowrap">Name</th>
                            <th class="text-nowrap">Date</th>
                            <th class="text-nowrap">Check In</th>
                            <th class="text-nowrap">Check Out</th>
                            <th class="text-nowrap">Total Hours</th>
                            <th class="text-nowrap">Status</th>
                        </tr>
                    </thead>

                    <tbody>
                        @if (Model == null || !Model.Any())
                        {
                            <tr>
                                <td colspan="7" class="text-center py-4 text-danger fw-bold">
                                    No records found...
                                </td>
                            </tr>
                        }
                        else
                        {
                            foreach (var a in Model)
                            {
                                var emp = employees.FirstOrDefault(e => e.EmployeeCode == a.Emp_Code);

                                <tr>
                                    <td class="text-nowrap">@a.Emp_Code</td>
                                    <td class="text-nowrap">@((emp?.Name) ?? "--")</td>
                                    <td class="text-nowrap">@a.AttDate.ToString("yyyy-MM-dd")</td>
                                    <td class="text-nowrap">@((a.InTime.HasValue) ? a.InTime.Value.ToString(@"hh\:mm") : "--")</td>
                                    <td class="text-nowrap">@((a.OutTime.HasValue) ? a.OutTime.Value.ToString(@"hh\:mm") : "--")</td>
                                    <td class="text-nowrap">@a.TotalHours</td>
                                    <td class="text-nowrap">
                                        @if (a.Status == "L")
                                        {
                                            <span class="badge bg-info text-dark pill-badge">Leave</span>
                                        }
                                        @*   else if (a.Status == "WOP" || a.Status == "WO")
                                        {
                                            <span class="badge bg-secondary pill-badge">Weekly Off</span>
                                        } *@
                                        @* Weekly Off – WOP *@
                                        else if (a.Status == "WOP")
                                        {
                                            <span class="badge bg-success pill-badge">Present</span>
                                        }

                                        @* Weekly Off – WO *@
                                        else if (a.Status == "WO")
                                        {
                                            <span class="badge bg-secondary pill-badge">Weekly Off</span>
                                        }
                                        else if (a.InTime.HasValue && !a.OutTime.HasValue)
                                        {
                                            <span class="badge bg-warning text-dark pill-badge">Not Checked Out</span>
                                        }


                                        else if (a.Status == "A")
                                        {
                                            <span class="badge bg-danger pill-badge">Absent</span>
                                        }
                                        else if (a.Status == "P")
                                        {
                                            <span class="badge bg-success pill-badge">Present</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-danger pill-badge">Absent</span>
                                        }
                                    </td>
                                    @* <td class="text-nowrap">
                                       
                                        @* ---- Normal Attendance ---- 
                                        else if (!a.InTime.HasValue)
                                        {
                                            <span class="badge bg-danger pill-badge">Absent</span>
                                        }
                                        else if (!a.OutTime.HasValue)
                                        {
                                            <span class="badge bg-warning text-dark pill-badge">Not Checked Out</span>
                                        }
                                       // else if (!a.InTime.HasValue)|| (!a.OutTime.HasValue)
                                        else if (a.InTime == null && a.OutTime == null)
                                        {
                                            <span class="badge bg-danger pill-badge">Leave</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success pill-badge">Present</span>
                                        }

                                    </td>
 *@

                                </tr>
                            }
                        }
                    </tbody>

                </table>
            </div>

        </div>
    </div>
</div>

<style>
    /* Compact, readable badges */
    .pill-badge {
        padding: 6px 10px;
        font-size: .85rem;
        border-radius: 999px;
    }

    /* Make sticky header look clean when table scrolls horizontally */
    .table-responsive {
        overflow-x: auto;
    }

    thead.sticky-top th {
        top: 0;
        z-index: 2;
    }

    /* Mobile tweaks */
    @@media (max-width: 992px) {
        .page-title {
            font-size: 1.4rem;
        }
    }

    @@media (max-width: 768px) {
        /* Make buttons full-width and stacked */
        .d-grid.d-md-flex .btn {
            width: 100%;
        }
        /* Reduce padding inside cards on phones */
        .card .card-body {
            padding: .75rem !important;
        }
        /* Reduce font a bit for table cells */
        .table td, .table th {
            font-size: .92rem;
        }
    }

    @@media (max-width: 480px) {
        .page-title {
            font-size: 1.2rem;
            text-align: center;
        }

        .form-label {
            font-size: .9rem;
        }
    }
</style>
   @*  ////////    Responsive Page   //////// *@