@model HRMS.Models.Payroll

@{
    ViewData["Title"] = "Create Payroll";
}

<div class="container mt-4">
    <h2 class="mb-4 text-primary fw-bold">Create Payroll</h2>
    <form asp-action="Create" method="post">

        <!-- Employee Information -->
        <div class="card mb-4 shadow-sm border-0">
            <div class="card-header bg-light fw-bold">Employee Information</div>
            <div class="card-body row g-3">
                <div class="col-md-4">
                    <label asp-for="EmployeeName" class="form-label"></label>
                    <input asp-for="EmployeeName" class="form-control" id="EmployeeName" required />
                    <span asp-validation-for="EmployeeName" class="text-danger"></span>
                </div>

                <div class="col-md-4">
                    <label asp-for="EmployeeCode" class="form-label"></label>
                    <input asp-for="EmployeeCode" class="form-control" id="EmployeeCode" />
                </div>

                <div class="col-md-4">
                    <label asp-for="Designation" class="form-label"></label>
                    <input asp-for="Designation" class="form-control" id="Designation" />
                </div>

                <div class="col-md-4">
                    <label asp-for="PAN" class="form-label"></label>
                    <input asp-for="PAN" class="form-control" id="PAN" />
                </div>

                <div class="col-md-4">
                    <label asp-for="BankAccountNumber" class="form-label"></label>
                    <input asp-for="BankAccountNumber" class="form-control" id="BankAccountNumber" />
                </div>

                <div class="col-md-4">
                    <label asp-for="BankName" class="form-label"></label>
                    <input asp-for="BankName" class="form-control" id="BankName" />
                </div>

                <div class="col-md-4">
                    <label asp-for="DateOfJoining" class="form-label"></label>
                    <input asp-for="DateOfJoining" type="date" class="form-control" id="DateOfJoining" />
                </div>

                <div class="col-md-4">
                    <label asp-for="MonthYear" class="form-label">Salary Month & Year</label>
                    <input asp-for="MonthYear" type="month" class="form-control" id="MonthYear" />
                </div>
            </div>
        </div>

        <!-- Earnings & Deductions -->
        <div class="row">
            <div class="col-md-6">
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-light fw-bold text-success">
                        <i class="bi bi-cash-coin me-1"></i> Earnings
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="BaseSalary" class="form-label">Base Salary</label>
                            <input asp-for="BaseSalary" class="form-control calc" id="BaseSalary" />
                        </div>
                        <div class="mb-3">
                            <label asp-for="PerformanceAllowance" class="form-label">Performance Allowance</label>
                            <input asp-for="PerformanceAllowance" class="form-control calc" id="PerformanceAllowance" />
                        </div>
                        <div class="mb-3">
                            <label asp-for="OtherAllowances" class="form-label">Other Allowances</label>
                            <input asp-for="OtherAllowances" class="form-control calc" id="OtherAllowances" />
                        </div>
                        <div class="mt-3">
                            <label class="fw-bold text-success">Total Earnings</label>
                            <input type="text" readonly class="form-control bg-light fw-bold" id="totalEarnings" name="TotalEarning" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-light fw-bold text-danger">
                        <i class="bi bi-bank me-1"></i> Deductions
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="ProfessionalTax" class="form-label">Professional Tax</label>
                            <input asp-for="ProfessionalTax" class="form-control calc" id="ProfessionalTax" />
                        </div>
                        <div class="mb-3">
                            <label asp-for="DeductionForLeaves" class="form-label">Deduction for Leaves</label>
                            <input asp-for="DeductionForLeaves" class="form-control calc" id="DeductionForLeaves" />
                        </div>
                        <div class="mt-3">
                            <label class="fw-bold text-danger">Total Deductions</label>
                            <input type="text" readonly class="form-control bg-light fw-bold" id="totalDeductions" name="TotalDeductions" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Net Pay & Attendance -->
        <div class="card mb-4 shadow-sm border-0">
            <div class="card-header bg-light fw-bold">Summary</div>
            <div class="card-body row g-3">
                <div class="col-md-4">
                    <label asp-for="NetPay" class="form-label text-success fw-bold">Net Pay</label>
                    <input asp-for="NetPay" class="form-control bg-success-subtle fw-bold" id="netPay" readonly />
                </div>
                <div class="col-md-4">
                    <label asp-for="TotalWorkingDays" class="form-label">Total Working Days</label>
                    <input asp-for="TotalWorkingDays" class="form-control" id="TotalWorkingDays" />
                </div>
                <div class="col-md-4">
                    <label asp-for="DaysAttended" class="form-label">Days Attended</label>
                    <input asp-for="DaysAttended" class="form-control" id="DaysAttended" />
                </div>
                <div class="col-md-4">
                    <label asp-for="TotalLeavesTaken" class="form-label">Total Leaves Taken</label>
                    <input asp-for="TotalLeavesTaken" class="form-control" id="TotalLeavesTaken" />
                </div>
            </div>
        </div>

        <!-- Submit -->
        <div class="text-end">
            <button type="submit" class="btn btn-primary px-4 fw-bold">Save Payroll</button>
            <a asp-action="Index" class="btn btn-secondary px-4">Cancel</a>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        (function () {
            function findEl(nameOrId) {
                return document.getElementById(nameOrId) || document.querySelector('[name="' + nameOrId + '"]');
            }

            function num(el) {
                if (!el) return 0;
                const v = parseFloat(el.value.toString().replace(/,/g, ''));
                return isNaN(v) ? 0 : v;
            }

            function write(el, value) {
                if (!el) return;
                el.value = value.toFixed(2);
            }

            function calculatePayroll() {
                const base = num(findEl('BaseSalary'));
                const pa = num(findEl('PerformanceAllowance'));
                const other = num(findEl('OtherAllowances'));
                const proTax = num(findEl('ProfessionalTax'));
                const dedLeave = num(findEl('DeductionForLeaves'));

                const totalEarnings = base + pa + other;
                const totalDeductions = proTax + dedLeave;
                const netPay = totalEarnings - totalDeductions;

                write(findEl('totalEarnings'), totalEarnings);
                write(findEl('totalDeductions'), totalDeductions);
                write(findEl('netPay'), netPay);
            }

            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('.calc').forEach(el => el.addEventListener('input', calculatePayroll));
                calculatePayroll();
                console.log('✅ Payroll auto calculation initialized');
            });
        })();
    </script>

    <partial name="_ValidationScriptsPartial" />
}
