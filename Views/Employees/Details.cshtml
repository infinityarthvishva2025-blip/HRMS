@model HRMS.Models.Employee
@using Microsoft.AspNetCore.Html

@{
    ViewData["Title"] = "Employee Details";
    Layout = "~/Views/Shared/_HrLayout.cshtml";

    string ViewUrl(string file) =>
        string.IsNullOrWhiteSpace(file)
            ? ""
            : Url.Action("ViewDocument", "Employees",
                new { empCode = Model.EmployeeCode, fileName = file });

    string DownloadUrl(string file) =>
        string.IsNullOrWhiteSpace(file)
            ? ""
            : Url.Action("DownloadDocument", "Employees",
                new { empCode = Model.EmployeeCode, fileName = file });

    // ===== INITIALS LOGIC =====
    var nameParts = Model.Name?
        .Split(' ', StringSplitOptions.RemoveEmptyEntries) ?? Array.Empty<string>();

    string initials = nameParts.Length switch
    {
        0 => "",
        1 => nameParts[0][0].ToString().ToUpper(),
        _ => (nameParts[0][0].ToString() + nameParts[^1][0].ToString()).ToUpper()
    };
}

<style>
    .box {
        border: 1px solid #e3e3e3;
        border-radius: 6px;
        padding: 18px;
        margin-bottom: 22px;
        background: #ffffff;
    }

    .box-title {
        font-weight: 600;
        color: #0d6efd;
        margin-bottom: 12px;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
    }

    .lbl {
        font-size: 0.85rem;
        color: #6c757d;
    }

    .val {
        font-weight: 600;
        color: #212529;
    }

    .doc-item {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px 12px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f8f9fa;
    }

    .doc-actions a {
        margin-left: 6px;
    }

    .initial-avatar {
        width: 110px;
        height: 110px;
        border-radius: 6px;
        background: #f1f5f9;
        border: 1px solid #dee2e6;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 42px;
        font-weight: 700;
        color: #475569;
        user-select: none;
    }
</style>

<div class="container py-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold text-primary">
            <i class="fa-solid fa-user"></i> Employee Profile
        </h4>
        <div>
            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning btn-sm me-2">Edit</a>
            <a asp-action="Index" class="btn btn-secondary btn-sm">Back</a>
        </div>
    </div>

    <!-- PROFILE -->
    <div class="box">
        <div class="row align-items-center">
            @{
                var profileUrl = ViewUrl(Model.ProfileImagePath);
                bool hasPhoto = !string.IsNullOrWhiteSpace(profileUrl);
            }

            <div class="col-md-2 text-center">
                <a href="@profileUrl" target="_blank"
                   style="@(hasPhoto ? "" : "pointer-events:none;")">
                    <img src="@profileUrl"
                         class="img-thumbnail"
                         style="max-height:110px; display:@(hasPhoto ? "block" : "none");"
                         onerror="
                            this.style.display='none';
                            document.getElementById('initials_@Model.Id').style.display='flex';
                         " />
                </a>

                <div id="initials_@Model.Id"
                     class="initial-avatar"
                     style="display:@(hasPhoto ? "none" : "flex");">
                    @initials
                </div>
            </div>

            <div class="col-md-10">
                <h5>@Model.Name</h5>
                <div class="text-muted">
                    Employee Code: <strong>@Model.EmployeeCode</strong>
                </div>
                <span class="badge bg-secondary">@Model.Role</span>
            </div>
        </div>
    </div>

    <!-- BASIC DETAILS -->
    <div class="box">
        <div class="box-title">Basic Details</div>
        <div class="row g-3">
            @Info("Email", Model.Email)
            @Info("Mobile", Model.MobileNumber)
            @Info("Alternate Mobile", Model.AlternateMobileNumber ?? "-")
            @Info("Gender", Model.Gender)
            @Info("DOB", Model.DOB_Date?.ToString("dd-MMM-yyyy") ?? "-")
            @Info("Marital Status", Model.MaritalStatus)
        </div>
    </div>

    <!-- ADDRESS -->
    <div class="box">
        <div class="box-title">Address</div>
        <div class="row g-3">
            @Info("Current Address", Model.Address)
            @Info("Permanent Address", Model.PermanentAddress)
        </div>
    </div>

    <!-- JOB DETAILS -->
    <div class="box">
        <div class="box-title">Job Details</div>
        <div class="row g-3">
            @Info("Joining Date", Model.JoiningDate?.ToString("dd-MMM-yyyy") ?? "-")
            @Info("Department", Model.Department)
            @Info("Position", Model.Position)
            @Info("Salary", Model.Salary?.ToString())
            @Info("Reporting Manager", Model.ReportingManager)
            @Info("Status", Model.Status)
        </div>
    </div>

    <!-- EXPERIENCE -->
    <div class="box">
        <div class="box-title">Experience</div>
        <div class="row g-3">
            @Info("Experience Type", Model.ExperienceType)
            @Info("Total Years", Model.TotalExperienceYears?.ToString() ?? "-")
            @Info("Last Company", Model.LastCompanyName)
        </div>

        <div class="mt-3">
            <strong>Experience Certificates</strong>
            @Files(Model.ExperienceCertificateFilePath, "Experience Certificate")
        </div>
    </div>

    <!-- EDUCATION -->
    <div class="box">
        <div class="box-title">Education</div>
        <div class="row g-3">
            @Info("12th Percentage", Model.HSCPercent?.ToString())
            @Info("Graduation Course", Model.GraduationCourse)
            @Info("Graduation %", Model.GraduationPercent?.ToString())
            @Info("Post Graduation", Model.PostGraduationCourse)
            @Info("PG %", Model.PostGraduationPercent?.ToString())
        </div>

        <div class="mt-3">
            <strong>Marksheet Documents</strong>
            @Document("12th Marksheet", Model.TwelfthMarksheetFilePath)
            @Document("Graduation Marksheet", Model.GraduationMarksheetFilePath)
            @Document("PG Marksheet", Model.PostGraduationMarksheetFilePath)
        </div>
    </div>

    <!-- ID / BANK / HEALTH -->
    <div class="box">
        <div class="box-title">ID / Bank / Health Documents</div>
        @Document("Aadhaar Card", Model.AadhaarFilePath)
        @Document("PAN Card", Model.PanFilePath)
        @Document("Bank Passbook", Model.PassbookFilePath)
        @Document("Medical Document", Model.MedicalDocumentFilePath)
    </div>

</div>

@functions {

    IHtmlContent Info(string label, string value) =>
        new HtmlString($@"
        <div class='col-md-4'>
            <div class='lbl'>{label}</div>
            <div class='val'>{value}</div>
        </div>");

    IHtmlContent Files(string files, string label)
    {
        if (string.IsNullOrWhiteSpace(files))
            return new HtmlString("<div class='text-muted'>Not uploaded</div>");

        var html = "";
        foreach (var f in files.Split(','))
            html += Document(label, f).ToString();

        return new HtmlString(html);
    }

    IHtmlContent Document(string label, string file)
    {
        if (string.IsNullOrWhiteSpace(file))
            return new HtmlString("");

        var viewUrl = Url.Action("ViewDocument", "Employees",
            new { empCode = Model.EmployeeCode, fileName = file });

        var downloadUrl = Url.Action("DownloadDocument", "Employees",
            new { empCode = Model.EmployeeCode, fileName = file });

        return new HtmlString($@"
        <div class='doc-item'>
            <div><strong>{label}</strong></div>
            <div class='doc-actions'>
                <a href='{viewUrl}' target='_blank'
                   class='btn btn-sm btn-outline-primary'>View</a>

                <a href='{downloadUrl}'
                   class='btn btn-sm btn-outline-success'>Download</a>
            </div>
        </div>");
    }
}
✅
@* @model HRMS.Models.Employee
@using Microsoft.AspNetCore.Html

@{
    ViewData["Title"] = "Employee Details";
    Layout = "~/Views/Shared/_HrLayout.cshtml";

    string DocUrl(string file) =>
        string.IsNullOrWhiteSpace(file)
            ? ""
            : Url.Action("ViewDocument", "Employees",
                new { empCode = Model.EmployeeCode, fileName = file });

    // ===== INITIALS LOGIC (SAFE) =====
    var nameParts = Model.Name?
        .Split(' ', StringSplitOptions.RemoveEmptyEntries) ?? Array.Empty<string>();

    string initials = nameParts.Length switch
    {
        0 => "",
        1 => nameParts[0][0].ToString().ToUpper(),
        _ => (nameParts[0][0].ToString() + nameParts[^1][0].ToString()).ToUpper()
    };
}

<style>
    .box {
        border: 1px solid #e3e3e3;
        border-radius: 6px;
        padding: 18px;
        margin-bottom: 22px;
        background: #ffffff;
    }

    .box-title {
        font-weight: 600;
        color: #0d6efd;
        margin-bottom: 12px;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
    }

    .lbl {
        font-size: 0.85rem;
        color: #6c757d;
    }

    .val {
        font-weight: 600;
        color: #212529;
    }

    .doc-item {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px 12px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f8f9fa;
    }

    .doc-actions a {
        margin-left: 6px;
    }

    /* ===== INITIAL AVATAR ===== */
    .initial-avatar {
        width: 110px;
        height: 110px;
        border-radius: 6px;
        background: #f1f5f9;
        border: 1px solid #dee2e6;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 42px;
        font-weight: 700;
        color: #475569;
        user-select: none;
    }
</style>

<div class="container py-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold text-primary">
            <i class="fa-solid fa-user"></i> Employee Profile
        </h4>
        <div>
            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning btn-sm me-2">Edit</a>
            <a asp-action="Index" class="btn btn-secondary btn-sm">Back</a>
        </div>
    </div>

    <!-- PROFILE -->
    <div class="box">
        <div class="row align-items-center">

            @{
                var profileUrl = DocUrl(Model.ProfileImagePath);
                bool hasPhoto = !string.IsNullOrWhiteSpace(profileUrl);
            }

            <div class="col-md-2 text-center">

                <a href="@profileUrl"
                   target="_blank"
                   style="@(hasPhoto ? "" : "pointer-events:none;")">

                    <img src="@profileUrl"
                         class="img-thumbnail profile-img"
                         style="max-height:110px; display:@(hasPhoto ? "block" : "none");"
                         onerror="
            this.style.display='none';
            document.getElementById('initials_@Model.Id').style.display='flex';
         " />
                </a>

                <div id="initials_@Model.Id"
                     class="initial-avatar"
                     style="display:@(hasPhoto ? "none" : "flex"); cursor:@(hasPhoto ? "pointer" : "default");"
                     ">
                    @initials
                </div>


            </div>



            <div class="col-md-10">
                <h5>@Model.Name</h5>
                <div class="text-muted">
                    Employee Code: <strong>@Model.EmployeeCode</strong>
                </div>
                <span class="badge bg-secondary">@Model.Role</span>
            </div>

        </div>
    </div>

    <!-- BASIC DETAILS -->
    <div class="box">
        <div class="box-title">Basic Details</div>
        <div class="row g-3">
            @Info("Email", Model.Email)
            @Info("Mobile", Model.MobileNumber)
            @Info("Alternate Mobile", Model.AlternateMobileNumber ?? "-")
            @Info("Gender", Model.Gender)
            @Info("DOB", Model.DOB_Date?.ToString("dd-MMM-yyyy") ?? "-")
            @Info("Marital Status", Model.MaritalStatus)
        </div>
    </div>

    <!-- ADDRESS -->
    <div class="box">
        <div class="box-title">Address</div>
        <div class="row g-3">
            @Info("Current Address", Model.Address)
            @Info("Permanent Address", Model.PermanentAddress)
        </div>
    </div>

    <!-- JOB DETAILS -->
    <div class="box">
        <div class="box-title">Job Details</div>
        <div class="row g-3">
            @Info("Joining Date", Model.JoiningDate?.ToString("dd-MMM-yyyy") ?? "-")
            @Info("Department", Model.Department)
            @Info("Position", Model.Position)
            @Info("Salary", Model.Salary?.ToString())
            @Info("Reporting Manager", Model.ReportingManager)
            @Info("Status", Model.Status)
        </div>
    </div>

    <!-- EXPERIENCE -->
    <div class="box">
        <div class="box-title">Experience</div>
        <div class="row g-3">
            @Info("Experience Type", Model.ExperienceType)
            @Info("Total Years", Model.TotalExperienceYears?.ToString() ?? "-")
            @Info("Last Company", Model.LastCompanyName)
        </div>

        <div class="mt-3">
            <strong>Experience Certificates</strong>
            @Files(Model.ExperienceCertificateFilePath, "Experience Certificate")
        </div>
    </div>

    <!-- EDUCATION -->
    <div class="box">
        <div class="box-title">Education</div>
        <div class="row g-3">
            @Info("12th Percentage", Model.HSCPercent?.ToString())
            @Info("Graduation Course", Model.GraduationCourse)
            @Info("Graduation %", Model.GraduationPercent?.ToString())
            @Info("Post Graduation", Model.PostGraduationCourse)
            @Info("PG %", Model.PostGraduationPercent?.ToString())
        </div>

        <div class="mt-3">
            <strong>Marksheet Documents</strong>
            @Document("12th Marksheet", Model.TwelfthMarksheetFilePath)
            @Document("Graduation Marksheet", Model.GraduationMarksheetFilePath)
            @Document("PG Marksheet", Model.PostGraduationMarksheetFilePath)
        </div>
    </div>

    <!-- ID / BANK / HEALTH -->
    <div class="box">
        <div class="box-title">ID / Bank / Health Documents</div>
        @Document("Aadhaar Card", Model.AadhaarFilePath)
        @Document("PAN Card", Model.PanFilePath)
        @Document("Bank Passbook", Model.PassbookFilePath)
        @Document("Medical Document", Model.MedicalDocumentFilePath)
    </div>

</div>

@functions {

    IHtmlContent Info(string label, string value) =>
        new HtmlString($@"
        <div class='col-md-4'>
            <div class='lbl'>{label}</div>
            <div class='val'>{value}</div>
        </div>");

    IHtmlContent Files(string files, string label)
    {
        if (string.IsNullOrWhiteSpace(files))
            return new HtmlString("<div class='text-muted'>Not uploaded</div>");

        var html = "";
        foreach (var f in files.Split(','))
            html += Document(label, f).ToString();

        return new HtmlString(html);
    }

    IHtmlContent Document(string label, string file)
    {
        if (string.IsNullOrWhiteSpace(file))
            return new HtmlString("");

        var url = Url.Action("ViewDocument", "Employees",
            new { empCode = Model.EmployeeCode, fileName = file });

        return new HtmlString($@"
        <div class='doc-item'>
            <div><strong>{label}</strong></div>
            <div class='doc-actions'>
                <a href='{url}' target='_blank' class='btn btn-sm btn-outline-primary'>View</a>
                <a href='{url}' download class='btn btn-sm btn-outline-success'>Download</a>
            </div>
        </div>");
    }
}
     *@