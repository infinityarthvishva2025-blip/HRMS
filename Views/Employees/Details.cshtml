@model HRMS.Models.Employee
@using Microsoft.AspNetCore.Html

@{
    ViewData["Title"] = "Employee Details";
    Layout = "~/Views/Shared/_HrLayout.cshtml";

    string baseFolderUrl = ViewBag.UrlFolder;             // URL path
    string basePhysicalFolder = ViewBag.PhysicalFolder;    // C:\HRMSFiles\IA000xx\
}

<style>
    .section-title {
        font-size: 1.15rem;
        font-weight: 600;
        color: #0d6efd;
        border-left: 4px solid #0d6efd;
        padding-left: 10px;
        margin-bottom: 15px;
    }

    .info-label {
        font-weight: 600;
        color: #444;
    }

    .file-box {
        border: 1px solid #ddd;
        padding: 8px;
        border-radius: 6px;
        text-align: center;
        background: #f8f9fa;
    }

        .file-box img {
            max-height: 120px;
            object-fit: contain;
            margin-bottom: 5px;
        }
</style>

<div class="container py-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-primary">
            <i class="fa-solid fa-user-circle me-2"></i> Employee Profile
        </h3>
        <div>
            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning btn-sm me-2">
                <i class="fa-solid fa-pen-to-square me-1"></i> Edit
            </a>
            <a asp-action="Index" class="btn btn-secondary btn-sm">
                <i class="fa-solid fa-arrow-left me-1"></i> Back
            </a>
        </div>
    </div>


    <!-- ======================= PROFILE CARD ======================== -->
    <div class="card shadow-sm border-0 p-4 mb-4">

        <div class="row">

            <!-- PROFILE IMAGE -->
            <div class="col-md-3 text-center">

                @if (!string.IsNullOrEmpty(Model.ProfileImagePath))
                {
                    string url = baseFolderUrl + Model.ProfileImagePath;
                    <img src="@url" class="img-thumbnail mb-2" style="max-height:180px;" />
                }
                else
                {
                    <div class="border rounded p-4 text-muted">No Photo</div>
                }

                <h5 class="mt-2 fw-bold">@Model.Name</h5>
                <p class="text-muted">Employee Code: <strong>@Model.EmployeeCode</strong></p>
                <span class="badge bg-primary">@Model.Role</span>
            </div>


            <!-- BASIC INFO -->
            <div class="col-md-9">

                <div class="section-title">Basic Details</div>
                <div class="row g-3">

                    <div class="col-md-4"><span class="info-label">Email:</span><br /> @Model.Email</div>
                    <div class="col-md-4"><span class="info-label">Mobile:</span><br /> @Model.MobileNumber</div>
                    <div class="col-md-4"><span class="info-label">Alt Mobile:</span><br /> @Model.AlternateMobileNumber ?? "-" </div>

                    <div class="col-md-4"><span class="info-label">Gender:</span><br /> @Model.Gender</div>
                    <div class="col-md-4"><span class="info-label">DOB:</span><br /> @(Model.DOB_Date?.ToString("dd-MMM-yyyy") ?? "-")</div>
                    <div class="col-md-4"><span class="info-label">Marital Status:</span><br /> @Model.MaritalStatus</div>

                </div>

                <hr />

                <div class="section-title">Address</div>

                <div class="mb-2"><span class="info-label">Current:</span><br /> @Model.Address</div>
                <div><span class="info-label">Permanent:</span><br /> @Model.PermanentAddress</div>

            </div>

        </div>

    </div>



    <!-- ======================= JOB DETAILS ======================== -->
    <div class="card shadow-sm border-0 p-4 mb-4">

        <div class="section-title">Job Details</div>

        <div class="row g-3">
            <div class="col-md-3"><span class="info-label">Joining Date:</span><br /> @(Model.JoiningDate?.ToString("dd-MMM-yyyy") ?? "-")</div>
            <div class="col-md-3"><span class="info-label">Department:</span><br /> @Model.Department</div>
            <div class="col-md-3"><span class="info-label">Position:</span><br /> @Model.Position</div>
            <div class="col-md-3"><span class="info-label">Salary:</span><br /> @Model.Salary</div>

            <div class="col-md-3"><span class="info-label">Reporting Manager:</span><br /> @Model.ReportingManager</div>
            <div class="col-md-3"><span class="info-label">Status:</span><br /> @Model.Status</div>
            <div class="col-md-3"><span class="info-label">Created At:</span><br /> @Model.CreatedAt.ToString("dd-MMM-yyyy HH:mm")</div>
        </div>

    </div>



    <!-- ======================= EXPERIENCE DETAILS ======================== -->
    <div class="card shadow-sm border-0 p-4 mb-4">

        <div class="section-title">Experience Details</div>

        <div class="row g-3">
            <div class="col-md-4"><span class="info-label">Type:</span><br /> @Model.ExperienceType</div>
            <div class="col-md-4"><span class="info-label">Years:</span><br /> @Model.TotalExperienceYears ?? "-" </div>
            <div class="col-md-4"><span class="info-label">Last Company:</span><br /> @Model.LastCompanyName</div>
        </div>

        <div class="mt-3">
            <span class="info-label">Certificates:</span><br />

            @if (!string.IsNullOrEmpty(Model.ExperienceCertificateFilePath))
            {
                var files = Model.ExperienceCertificateFilePath.Split(',');

                <div class="row g-2 mt-1">
                    @foreach (var f in files)
                    {
                        @DisplayFile(f)
                    }
                </div>
            }
            else
            {
                <span class="text-muted">No certificates uploaded.</span>
            }
        </div>

    </div>



    <!-- ======================= EDUCATION DETAILS ======================== -->
    <div class="card shadow-sm border-0 p-4 mb-4">

        <div class="section-title">Education</div>

        <div class="row g-3">

            <div class="col-md-4"><span class="info-label">12th %:</span><br /> @Model.HSCPercent</div>
            <div class="col-md-4"><span class="info-label">Graduation:</span><br /> @Model.GraduationCourse</div>
            <div class="col-md-4"><span class="info-label">Graduation %:</span><br /> @Model.GraduationPercent</div>

            <div class="col-md-4"><span class="info-label">PG:</span><br /> @Model.PostGraduationCourse</div>
            <div class="col-md-4"><span class="info-label">PG %:</span><br /> @Model.PostGraduationPercent</div>

        </div>

        <hr />

        <div class="section-title">Marksheet Files</div>

        <div class="row g-3">

            <div class="col-md-3"><span class="info-label">12th Marksheet</span><br /> @DisplayFile(Model.TwelfthMarksheetFilePath)</div>
            <div class="col-md-3"><span class="info-label">Graduation Marksheet</span><br /> @DisplayFile(Model.GraduationMarksheetFilePath)</div>
            <div class="col-md-3"><span class="info-label">PG Marksheet</span><br /> @DisplayFile(Model.PostGraduationMarksheetFilePath)</div>

        </div>

    </div>



    <!-- ======================= ID & BANK DETAILS ======================== -->
    <div class="card shadow-sm border-0 p-4 mb-4">

        <div class="section-title">ID Proofs</div>

        <div class="row g-3">
            <div class="col-md-4"><span class="info-label">Aadhaar:</span><br /> @Model.AadhaarNumber</div>
            <div class="col-md-4"><span class="info-label">PAN:</span><br /> @Model.PanNumber</div>
        </div>

        <div class="row g-3 mt-2">
            <div class="col-md-3">@DisplayFile(Model.AadhaarFilePath)</div>
            <div class="col-md-3">@DisplayFile(Model.PanFilePath)</div>
            <div class="col-md-3">@DisplayFile(Model.PassbookFilePath)</div>
        </div>

        <hr />

        <div class="section-title">Bank Details</div>

        <div class="row g-3">
            <div class="col-md-4"><span class="info-label">Account Holder:</span><br /> @Model.AccountHolderName</div>
            <div class="col-md-4"><span class="info-label">Bank Name:</span><br /> @Model.BankName</div>
            <div class="col-md-4"><span class="info-label">Account No:</span><br /> @Model.AccountNumber</div>
            <div class="col-md-4"><span class="info-label">IFSC:</span><br /> @Model.IFSC</div>
            <div class="col-md-4"><span class="info-label">Branch:</span><br /> @Model.Branch</div>
        </div>

        <hr />

        <div class="section-title">Emergency Contact</div>

        <div class="row g-3">
            <div class="col-md-4"><span class="info-label">Name:</span><br /> @Model.EmergencyContactName</div>
            <div class="col-md-4"><span class="info-label">Relation:</span><br /> @Model.EmergencyContactRelationship</div>
            <div class="col-md-4"><span class="info-label">Mobile:</span><br /> @Model.EmergencyContactMobile</div>
            <div class="col-md-12"><span class="info-label">Address:</span><br /> @Model.EmergencyContactAddress</div>
        </div>

        <hr />

        <div class="section-title">Health Info</div>

        <div class="row g-3">

            <div class="col-md-4"><span class="info-label">Has Disease:</span><br /> @Model.HasDisease</div>
            <div class="col-md-4"><span class="info-label">Disease Name:</span><br /> @Model.DiseaseName</div>
            <div class="col-md-4"><span class="info-label">Since:</span><br /> @Model.DiseaseSince</div>

            <div class="col-md-4"><span class="info-label">Medicines:</span><br /> @Model.MedicinesRequired</div>
            <div class="col-md-4"><span class="info-label">Doctor:</span><br /> @Model.DoctorName</div>
            <div class="col-md-4"><span class="info-label">Doctor Contact:</span><br /> @Model.DoctorContact</div>

            <div class="col-md-4"><span class="info-label">Last Affected:</span><br /> @Model.LastAffectedDate</div>
            <div class="col-md-4">@DisplayFile(Model.MedicalDocumentFilePath)</div>

        </div>

    </div>

</div>


<!-- ===================================================================== -->
<!-- FILE PREVIEW FUNCTION (UPDATED FOR C:\HRMSFiles\ FOLDER) -->
<!-- ===================================================================== -->
@functions {

    public IHtmlContent DisplayFile(string file)
    {
        if (string.IsNullOrEmpty(file))
        {
            return new HtmlString("<span class='text-muted'>Not uploaded</span>");
        }

        string url = ViewBag.UrlFolder + file;
        string ext = System.IO.Path.GetExtension(file)?.ToLower();

        string html = "<div class='file-box'>";

        if (new[] { ".jpg", ".jpeg", ".png", ".gif", ".bmp", ".webp" }.Contains(ext))
        {
            html += $"<img src='{url}' />";
        }
        else
        {
            html += "<i class='fa-solid fa-file-pdf fa-3x text-danger'></i><br />";
        }

        html += $"<a href='{url}' target='_blank'>View / Download</a></div>";

        return new HtmlString(html);
    }
}
