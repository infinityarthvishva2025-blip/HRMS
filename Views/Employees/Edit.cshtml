@model HRMS.Models.Employee

@{
    ViewData["Title"] = "Edit Employee";
    Layout = "_Layout";
}

<div class="container py-4">

    <h3 class="fw-bold text-primary mb-4">
        <i class="fa fa-edit me-1"></i> Edit Employee
    </h3>

    <form asp-action="Edit" asp-controller="Employees" method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="Id" />

        @* Profile *@
        @{
            var photoPath = string.IsNullOrEmpty(Model.ProfileImagePath)
            ? "/images/default-user.png"
            : "/uploads/profiles/" + Model.ProfileImagePath;
        }

        <div class="row">

            <!-- LEFT PHOTO -->
            <div class="col-lg-3 text-center">
                <img src="@photoPath" class="rounded mb-3"
                     style="width: 180px; height: 180px; object-fit: cover;">

                <input type="file" name="ProfilePhoto" class="form-control" />
            </div>

            <!-- RIGHT FORM -->
            <div class="col-lg-9">

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-body">

                        <h5 class="fw-bold border-bottom pb-2 mb-3">Basic Details</h5>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label asp-for="EmployeeCode"></label>
                                <input asp-for="EmployeeCode" class="form-control" readonly />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="Name"></label>
                                <input asp-for="Name" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="Email"></label>
                                <input asp-for="Email" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="MobileNumber"></label>
                                <input asp-for="MobileNumber" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="Password">New Password (optional)</label>
                                <input asp-for="Password" type="password" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="ConfirmPassword">Confirm New Password</label>
                                <input asp-for="ConfirmPassword" type="password" class="form-control" />
                            </div>
                        </div>

                        <h5 class="fw-bold border-bottom pb-2 mt-4">Personal Details</h5>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label asp-for="Gender"></label>
                                <select asp-for="Gender" class="form-select">
                                    <option>Male</option>
                                    <option>Female</option>
                                    <option>Other</option>
                                </select>
                            </div>

                            <div class="col-md-4">
                                <label asp-for="FatherName"></label>
                                <input asp-for="FatherName" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="MotherName"></label>
                                <input asp-for="MotherName" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="DOB_Date"></label>
                                <input asp-for="DOB_Date" type="date" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="MaritalStatus"></label>
                                <select asp-for="MaritalStatus" class="form-select">
                                    <option>Single</option>
                                    <option>Married</option>
                                    <option>Divorced</option>
                                    <option>Widowed</option>
                                </select>
                            </div>
                        </div>

                        <h5 class="fw-bold border-bottom pb-2 mt-4">Experience</h5>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label asp-for="ExperienceType"></label>
                                <select asp-for="ExperienceType" id="ExperienceType" class="form-select">
                                    <option value="">-- Select --</option>
                                    <option value="Fresher">Fresher</option>
                                    <option value="Experienced">Experienced</option>
                                </select>
                            </div>

                            <div class="col-md-4">
                                <label asp-for="TotalExperienceYears"></label>
                                <input asp-for="TotalExperienceYears" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="LastCompanyName"></label>
                                <input asp-for="LastCompanyName" class="form-control" />
                            </div>
                        </div>

                        <h5 class="fw-bold border-bottom pb-2 mt-4">Job Details</h5>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label asp-for="JoiningDate"></label>
                                <input asp-for="JoiningDate" type="date" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="Department"></label>
                                <select asp-for="Department" id="Department" class="form-select">
                                    <option value="">-- Select --</option>
                                    <option>IT</option>
                                    <option>HR</option>
                                    <option>Finance</option>
                                    <option>Marketing</option>
                                    <option>Accounting</option>
                                </select>
                            </div>

                            <div class="col-md-4">
                                <label asp-for="Position"></label>
                                <select asp-for="Position" id="Position" class="form-select"></select>
                            </div>

                            <div class="col-md-4">
                                <label asp-for="Salary"></label>
                                <input asp-for="Salary" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="ReportingManager"></label>
                                <input asp-for="ReportingManager" class="form-control" />
                            </div>

                            <div class="col-md-12">
                                <label asp-for="Address"></label>
                                <textarea asp-for="Address" rows="2" class="form-control"></textarea>
                            </div>
                        </div>

                        <h5 class="fw-bold border-bottom pb-2 mt-4">Education</h5>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label asp-for="HSCPercent"></label>
                                <input asp-for="HSCPercent" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="GraduationCourse"></label>
                                <select asp-for="GraduationCourse" class="form-select">
                                    <option>BCA</option>
                                    <option>BCS</option>
                                    <option>BBA</option>
                                    <option>B.Com</option>
                                    <option>Other</option>
                                </select>
                            </div>

                            <div class="col-md-4">
                                <label asp-for="GraduationPercent"></label>
                                <input asp-for="GraduationPercent" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="PostGraduationCourse"></label>
                                <input asp-for="PostGraduationCourse" class="form-control" />
                            </div>

                            <div class="col-md-4">
                                <label asp-for="PostGraduationPercent"></label>
                                <input asp-for="PostGraduationPercent" class="form-control" />
                            </div>
                        </div>

                        <h5 class="fw-bold border-bottom pb-2 mt-4">Identity Details</h5>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="AadhaarNumber"></label>
                                <input asp-for="AadhaarNumber" class="form-control" />
                            </div>

                            <div class="col-md-6">
                                <label asp-for="PanNumber"></label>
                                <input asp-for="PanNumber" class="form-control text-uppercase" />
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>

        <button type="submit" class="btn btn-success px-4 mt-3">
            <i class="fa fa-check me-1"></i> Save Changes
        </button>

        <a asp-action="Index" class="btn btn-secondary mt-3">Back</a>

    </form>
</div>

@section Scripts {
    <script>
        // Department → Position loader
        const dept = document.getElementById("Department");
        const pos = document.getElementById("Position");

        if (dept && pos) {
            dept.addEventListener("change", loadPositions);

            loadPositions(); // auto-fill on edit

            function loadPositions() {
                const d = dept.value;
                pos.innerHTML = "";

                if (!d) return;

                fetch(`/Employees/GetPositions?department=${encodeURIComponent(d)}`)
                    .then(r => r.json())
                    .then(list => {
                        const def = document.createElement("option");
                        def.value = "";
                        def.textContent = "-- Select --";
                        pos.appendChild(def);

                        list.forEach(p => {
                            const opt = document.createElement("option");
                            opt.value = p;
                            opt.textContent = p;
                            pos.appendChild(opt);
                        });

                        pos.value = "@Model.Position";
                    });
            }
        }
    </script>
}
