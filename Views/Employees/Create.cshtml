@model HRMS.Models.Employee

@{
    ViewData["Title"] = "Add Employee";
    Layout = "~/Views/Shared/_HrLayout.cshtml";
}

<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-primary">
            <i class="fa-solid fa-user-plus me-2"></i> Add New Employee
        </h3>

        <a asp-controller="Employees" asp-action="Index" class="btn btn-outline-primary">
            <i class="fa-solid fa-list me-1"></i> See All Employees
        </a>
    </div>

    <form asp-action="Create" method="post" enctype="multipart/form-data" id="employeeForm">
        @Html.AntiForgeryToken()

        <div asp-validation-summary="All" class="text-danger mb-3"></div>

        <div class="card shadow-sm border-0 p-4">

            <!-- BASIC DETAILS -->
            <h5 class="fw-bold text-secondary mb-3">Basic Details</h5>
            <div class="row g-3">

                <div class="col-md-4">
                    <label asp-for="EmployeeCode" class="form-label"></label>
                    <input asp-for="EmployeeCode" class="form-control" readonly />
                </div>

                <div class="col-md-4">
                    <label asp-for="Name" class="form-label"></label>
                    <input asp-for="Name" class="form-control" required minlength="2" />
                    <span class="text-danger" asp-validation-for="Name"></span>
                </div>

                <div class="col-md-4">
                    <label asp-for="Email" class="form-label"></label>
                    <input asp-for="Email" type="email" class="form-control" required />
                    <span class="text-danger" asp-validation-for="Email"></span>
                </div>

                <div class="col-md-4">
                    <label asp-for="MobileNumber" class="form-label"></label>
                    <input asp-for="MobileNumber" class="form-control"
                           required maxlength="10" minlength="10" pattern="[0-9]{10}"
                           title="Enter a valid 10-digit mobile number" />
                    <span class="text-danger" asp-validation-for="MobileNumber"></span>
                </div>

                <div class="col-md-4">
                    <label asp-for="Password" class="form-label"></label>
                    <div class="input-group">
                        <input asp-for="Password" type="password" class="form-control" id="Password" required minlength="6" />
                        <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('Password', this)">
                            <i class="fa fa-eye"></i>
                        </button>
                    </div>
                    <span class="text-danger" asp-validation-for="Password"></span>
                </div>

                <div class="col-md-4">
                    <label asp-for="ConfirmPassword" class="form-label"></label>
                    <div class="input-group">
                        <input asp-for="ConfirmPassword" type="password" class="form-control" id="ConfirmPassword"
                               required minlength="6" oninput="validatePasswordMatch()" />
                        <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('ConfirmPassword', this)">
                            <i class="fa fa-eye"></i>
                        </button>
                    </div>
                    <span class="text-danger" id="passwordError"></span>
                </div>

            </div>

            <hr class="my-4" />

            <!-- PERSONAL DETAILS -->
            <h5 class="fw-bold text-secondary mb-3">Personal Details</h5>

            <div class="row g-3">
                <div class="col-md-3">
                    <label asp-for="Gender"></label>
                    <select asp-for="Gender" class="form-select" required>
                        <option value="">-- Select --</option>
                        <option>Male</option>
                        <option>Female</option>
                        <option>Other</option>
                    </select>
                </div>

                <div class="col-md-3">
                    <label asp-for="FatherName"></label>
                    <input asp-for="FatherName" class="form-control" required />
                </div>

                <div class="col-md-3">
                    <label asp-for="MotherName"></label>
                    <input asp-for="MotherName" class="form-control" required />
                </div>

                <div class="col-md-3">
                    <label asp-for="DOB_Date"></label>
                    <input asp-for="DOB_Date" type="date" class="form-control" required max="@DateTime.Today.ToString("yyyy-MM-dd")" />
                </div>

                <div class="col-md-3">
                    <label asp-for="MaritalStatus"></label>
                    <select asp-for="MaritalStatus" class="form-select" required>
                        <option value="">-- Select --</option>
                        <option>Single</option>
                        <option>Married</option>
                        <option>Divorced</option>
                        <option>Widowed</option>
                    </select>
                </div>

            </div>

            <hr class="my-4" />

            <!-- EXPERIENCE -->
            <h5 class="fw-bold text-secondary mb-3">Experience Details</h5>

            <div class="row g-3">
                <div class="col-md-4">
                    <label asp-for="ExperienceType"></label>
                    <select asp-for="ExperienceType" id="ExperienceType" class="form-select" required>
                        <option value="">-- Select --</option>
                        <option value="Fresher">Fresher</option>
                        <option value="Experienced">Experienced</option>
                    </select>
                </div>
            </div>

            <div class="row g-3 mt-2 d-none" id="experience-section">
                <div class="col-md-4">
                    <label asp-for="TotalExperienceYears"></label>
                    <input asp-for="TotalExperienceYears" type="number" min="1" max="40" class="form-control" />
                </div>

                <div class="col-md-4">
                    <label asp-for="LastCompanyName"></label>
                    <input asp-for="LastCompanyName" class="form-control" />
                </div>
            </div>

            <hr class="my-4" />

            <!-- JOB DETAILS -->
            <h5 class="fw-bold text-secondary mb-3">Job Details</h5>

            <div class="row g-3">
                <div class="col-md-4">
                    <label asp-for="JoiningDate"></label>
                    <input asp-for="JoiningDate" type="date" class="form-control" required />
                </div>


                <div class="col-md-4">
                    <label asp-for="Department"></label>
                    <select asp-for="Department" id="Department" class="form-select" required>
                        <option value="">-- Select --</option>
                        <option>IT</option>
                        <option>HR</option>
                        <option>Finance</option>
                        <option>Marketing</option>
                        <option>Accounting</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label asp-for="Position"></label>
                    <select asp-for="Position" id="Position" class="form-select" required>
                        <option value="">-- Select Position --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label asp-for="Role" class="form-label"></label>
                    <select asp-for="Role" class="form-select" required>
                        <option value="">-- Select Role --</option>
                        <option>Employee</option>
                        <option>Manager</option>
                        <option>Vice President</option>
                        <option>Director</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label asp-for="Salary"></label>
                    <input asp-for="Salary" type="number" class="form-control" required min="1000" />
                </div>

                <div class="col-md-8">
                    <label asp-for="ReportingManager"></label>
                    <input asp-for="ReportingManager" class="form-control" required />
                </div>

                <div class="col-md-12">
                    <label asp-for="Address"></label>
                    <textarea asp-for="Address" class="form-control" rows="2" required></textarea>
                </div>

            </div>

            <hr class="my-4" />

            <!-- EDUCATION -->
            <h5 class="fw-bold text-secondary mb-3">Education</h5>

            <div class="row g-3">

                <div class="col-md-4">
                    <label asp-for="HSCPercent"></label>
                    <input asp-for="HSCPercent" type="number" min="35" max="100" class="form-control" />
                </div>

                <div class="col-md-4">
                    <label asp-for="GraduationCourse"></label>
                    <select asp-for="GraduationCourse" class="form-select">
                        <option value="">-- Select Graduation --</option>
                        <option>BCA</option>
                        <option>BCS</option>
                        <option>BBA</option>
                        <option>B.Com</option>
                        <option>BA</option>
                        <option>B.Sc</option>
                        <option>BE</option>
                        <option>B.Tech</option>
                        <option>Other</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label asp-for="GraduationPercent"></label>
                    <input asp-for="GraduationPercent" type="number" min="35" max="100" class="form-control" />
                </div>

                <div class="col-md-4">
                    <label asp-for="PostGraduationCourse"></label>
                    <select asp-for="PostGraduationCourse" class="form-select">
                        <option value="">-- Select PG --</option>
                        <option>MCA</option>
                        <option>MBA</option>
                        <option>M.Com</option>
                        <option>M.Sc</option>
                        <option>ME</option>
                        <option>M.Tech</option>
                        <option>Other</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label asp-for="PostGraduationPercent"></label>
                    <input asp-for="PostGraduationPercent" type="number" min="35" max="100" class="form-control" />
                </div>

            </div>

            <hr class="my-4" />

            <!-- ID DETAILS -->
            <h5 class="fw-bold text-secondary mb-3">Identity Details</h5>

            <div class="row g-3">

                <div class="col-md-4">
                    <label asp-for="AadhaarNumber"></label>
                    <input asp-for="AadhaarNumber" class="form-control"
                           pattern="[0-9]{12}"
                           title="Aadhaar must be 12 digits" />
                </div>

                <div class="col-md-4">
                    <label asp-for="PanNumber"></label>
                    <input asp-for="PanNumber" class="form-control"
                           pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}"
                           title="Enter valid PAN e.g. ABCDE1234F" />
                </div>

            </div>


            <hr class="my-4" />

            <!-- BANK DETAILS -->
            <h5 class="fw-bold text-secondary mb-3">Bank Details</h5>

            <div class="row g-3">

                <div class="col-md-6">
                    <label asp-for="BankName"></label>
                    <input asp-for="BankName" class="form-control" required />
                </div>
                <div class="col-md-6">
                    <label asp-for="Branch"></label>
                    <input asp-for="Branch" class="form-control" required />
                </div>

                <div class="col-md-6">
                    <label asp-for="AccountHolderName"></label>
                    <input asp-for="AccountHolderName" class="form-control" required />
                </div>

                <div class="col-md-6">
                    <label asp-for="AccountNumber"></label>
                    <input asp-for="AccountNumber" class="form-control"
                           pattern="[0-9]{9,18}"
                           title="Account number must be 9–18 digits" required />
                </div>

                <div class="col-md-6">
                    <label asp-for="IFSC"></label>
                    <input asp-for="IFSC" class="form-control"
                           pattern="[A-Z]{4}0[A-Z0-9]{6}"
                           title="Enter valid IFSC e.g. HDFC0001234" required />
                </div>

            </div>

            <hr class="my-4" />

            <!-- NEW DOCUMENT UPLOADS -->
            <h5 class="fw-bold text-secondary mb-3">Document Uploads</h5>

            <div class="row g-3">

                <div class="col-md-6">
                    <label>Aadhaar Card (PDF / Image)</label>
                    <input type="file" name="AadhaarFile" class="form-control" accept=".pdf,image/*" />
                </div>

                <div class="col-md-6">
                    <label>PAN Card (PDF / Image)</label>
                    <input type="file" name="PanFile" class="form-control" accept=".pdf,image/*" />
                </div>

                <div class="col-md-6">
                    <label>Bank Passbook (PDF / Image)</label>
                    <input type="file" name="PassbookFile" class="form-control" accept=".pdf,image/*" />
                </div>

                <div class="col-md-6">
                    <label>Marksheet (PDF / Image)</label>
                    <input type="file" name="MarksheetFile" class="form-control" accept=".pdf,image/*" />
                </div>

            </div>

            <hr class="my-4" />

            <!-- PROFILE PHOTO -->
            <h5 class="fw-bold text-secondary mb-3">Profile Photo</h5>
            <div class="col-md-6">
                <input type="file" name="ProfilePhoto" class="form-control" accept="image/*" required />
            </div>

        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-success px-4">
                <i class="fa-solid fa-check me-1"></i>
                Save Employee
            </button>
        </div>

    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>

        function validatePasswordMatch() {
            const pwd = document.getElementById("Password");
            const conf = document.getElementById("ConfirmPassword");
            const err = document.getElementById("passwordError");

            if (pwd.value !== conf.value) {
                err.textContent = "Passwords do not match.";
            } else {
                err.textContent = "";
            }
        }

        const expType = document.getElementById("ExperienceType");
        const expSection = document.getElementById("experience-section");

        expType.addEventListener("change", () => {
            if (expType.value === "Experienced") {
                expSection.classList.remove("d-none");
            } else {
                expSection.classList.add("d-none");
            }
        });

        function togglePassword(fieldId, btn) {
            const input = document.getElementById(fieldId);
            const icon = btn.querySelector("i");

            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                input.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        }

        const dept = document.getElementById("Department");
        const pos = document.getElementById("Position");

        dept.addEventListener("change", function () {
            pos.innerHTML = "";

            fetch(`/Employees/GetPositions?department=${this.value}`)
                .then(r => r.json())
                .then(list => {
                    pos.innerHTML = '<option value="">-- Select Position --</option>';
                    list.forEach(item => {
                        pos.innerHTML += `<option value="${item}">${item}</option>`;
                    });
                });
        });

    </script>
}
