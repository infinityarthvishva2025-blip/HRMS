@model HRMS.Models.Assets
@{
    ViewData["Title"] = "Add New Asset";
}

<div class="container mt-4">
    <h2 class="mb-4">Add New Asset</h2>

    <div class="card p-4 shadow-sm">
        <form asp-action="Create" method="post">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label asp-for="Category" class="form-label">Category</label>
                    <select asp-for="Category" class="form-control" id="Category">
                        <option value="">-- Select Category --</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Furniture">Furniture</option>
                        <option value="Vehicle">Vehicle</option>
                        <option value="Accessories">Accessories</option>
                        <option value="Other">Other</option>
                    </select>
                    <span asp-validation-for="Category" class="text-danger"></span>
                </div>

                <div class="col-md-6">
                    <label asp-for="AssetName" class="form-label">Asset Name</label>
                    <input asp-for="AssetName" class="form-control" />
                    <span asp-validation-for="AssetName" class="text-danger"></span>
                </div>
            </div>

            <!-- Serial Number always visible -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label asp-for="SerialNo" class="form-label">Serial Number</label>
                    <input asp-for="SerialNo" class="form-control" placeholder="Enter Serial Number" />
                    <span asp-validation-for="SerialNo" class="text-danger"></span>
                </div>
            </div>

            <!-- Electronics Hardware Section (hidden by default) -->
            <div id="ElectronicsDetails" class="row mb-3" style="display:none;">
                <div class="col-md-4">
                    <label class="form-label">RAM</label>
                    <input type="text" name="RAM" class="form-control" placeholder="e.g. 8GB" />
                </div>
                <div class="col-md-4">
                    <label class="form-label">Storage</label>
                    <input type="text" name="Storage" class="form-control" placeholder="e.g. 512GB SSD" />
                </div>
                <div class="col-md-4">
                    <label class="form-label">Processor</label>
                    <input type="text" name="Processor" class="form-control" placeholder="e.g. Intel i5" />
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label asp-for="PurchaseDate" class="form-label">Purchase Date</label>
                    <input asp-for="PurchaseDate" class="form-control" type="date" />
                </div>
                <div class="col-md-6">
                    <label asp-for="Cost" class="form-label">Cost</label>
                    <input asp-for="Cost" class="form-control" />
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label asp-for="Status" class="form-label">Status</label>
                    <input asp-for="Status" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label asp-for="AssignedTo" class="form-label">Assigned To</label>
                    <input asp-for="AssignedTo" class="form-control" />
                </div>
            </div>

            <div class="mb-3">
                <label asp-for="Remarks" class="form-label">Remarks</label>
                <textarea asp-for="Remarks" class="form-control"></textarea>
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success">Save</button>
                <a asp-action="Index" class="btn btn-secondary">Back</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const categorySelect = document.getElementById("Category");
            const electronicsDetails = document.getElementById("ElectronicsDetails");

            if (!categorySelect || !electronicsDetails) {
                console.error("Category or electronics section not found.");
                return;
            }

            function toggleElectronicsFields() {
                const selected = categorySelect.value.trim().toLowerCase();
                if (selected === "electronics") {
                    electronicsDetails.style.display = "flex";
                } else {
                    electronicsDetails.style.display = "none";
                }
            }

            toggleElectronicsFields(); // Run when page loads
            categorySelect.addEventListener("change", toggleElectronicsFields);
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {

            // 🔹 DYNAMIC LEAVE UI
            $("#LeaveCategory").change(function () {
                let type = $(this).val();

                $("#FullDayBlock").hide();
                $("#HalfDayBlock").hide();
                $("#TimeBlock").hide();

                if (type === "FullDay") {
                    $("#FullDayBlock").show();
                }
                else if (type === "HalfDay") {
                    $("#HalfDayBlock").show();
                }
                else if (type === "EarlyGoing" || type === "LateComing") {
                    $("#TimeBlock").show();
                }
            });


            // 🔹 SEARCH CONTROL
            $("#managerSearch").on("keyup focus", function () {
                let term = $(this).val();

                $.ajax({
                    url: '/Leave/SearchManagers',
                    method: 'GET',
                    data: { term: term },
                    success: function (data) {
                        let list = $("#managerList");
                        list.empty();

                        if (data.length === 0) {
                            list.hide();
                            return;
                        }

                        data.forEach(item => {
                            list.append(`
                                <div class="autocomplete-item p-2" data-id="${item.id}">
                                    ${item.name}
                                </div>
                            `);
                        });

                        list.show();
                    }
                });
            });

            // WHEN SELECTING
            $(document).on("click", ".autocomplete-item", function () {
                $("#ReportingManagerId").val($(this).data("id"));
                $("#managerSearch").val($(this).text());
                $("#managerList").hide();
            });

            // CLICK OUTSIDE → HIDE
            $(document).click(function (e) {
                if (!$(e.target).closest("#managerSearch").length &&
                    !$(e.target).closest("#managerList").length) {
                    $("#managerList").hide();
                }
            });

        });
    </script>

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
