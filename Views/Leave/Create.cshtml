@* @model HRMS.Models.Leave

@{
    ViewData["Title"] = "Apply for Leave";

    var role = ViewBag.UserRole as string;
    if (role == "HR" || role == "VP" || role == "GM" || role == "Director")
    {
        Layout = "~/Views/Shared/_HrLayout.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/_EmployeeLayout.cshtml";
    }
}

<style>
    .leave-title {
        font-size: 1.6rem;
        font-weight: 600;
    }

    .form-label {
        font-weight: 600;
    }

    .leave-card {
        border-radius: 16px;
        background: #fff;
        padding: 35px;
        max-width: 650px;
        margin: auto;
        box-shadow: 0 3px 18px rgba(0,0,0,0.1);
    }
</style>

<div class="container">
    <div class="leave-card">

        <div class="leave-title">Apply for Leave</div>
        <hr />

        <form asp-action="Create" method="post" id="leaveForm">

            <!-- CATEGORY -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Leave Category</label>
                    <select asp-for="Category" id="Category" class="form-select">
                        <option value="">-- Select --</option>
                        <option value="FullDay">Full Day</option>
                        <option value="MultiDay">More Than 1 Day</option>
                        <option value="HalfDay">Half Day</option>
                        <option value="EarlyGoing">Early Going</option>
                        <option value="LateComing">Late Coming</option>
                    </select>
                </div>

                <div id="leaveTypeBlock" class="col-md-6" style="display:none;">
                    <label class="form-label">Leave Type</label>
                    <select asp-for="LeaveType" id="LeaveType" class="form-select">
                        <option value="">-- Select Leave Type --</option>
                        <option value="Sick">Sick</option>
                        <option value="Casual">Casual</option>
                        <option value="coff">Comp-Off</option>
                    </select>
                </div>
            </div>

            <!-- 🟢 COMP-OFF DATE (ONLY FOR COFF) -->
            <div id="compOffDateBlock" class="row mb-3" style="display:none;">
                <div class="col-md-6">
                    <label class="form-label">Comp-Off Earned Date</label>
                    <select id="CompOffDate" name="CompOffDate" class="form-select">
                        <option value="">-- Select Date --</option>
                        @foreach (var d in ViewBag.CompOffDates as List<DateTime> ?? new())
                        {
                            <option value="@d.ToString("yyyy-MM-dd")">
                                @d.ToString("dd-MMM-yyyy")
                            </option>
                        }
                    </select>
                </div>
            </div>

            <!-- FULL / MULTI DAY -->
            <div id="fullOrMultiDayBlock" class="row mb-3" style="display:none;">
                <div class="col-md-6">
                    <label>Start Date</label>
                    <input asp-for="StartDate" type="date" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label>End Date</label>
                    <input asp-for="EndDate" type="date" class="form-control" />
                </div>
            </div>

            <!-- HALF DAY -->
            <div id="halfDayBlock" class="row mb-3" style="display:none;">
                <div class="col-md-6">
                    <label>Date</label>
                    <input asp-for="StartDate" type="date" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label>Session</label>
                    <select asp-for="HalfDaySession" class="form-select">
                        <option value="">-- Select --</option>
                        <option value="FirstHalf">First Half</option>
                        <option value="SecondHalf">Second Half</option>
                    </select>
                </div>
            </div>

            <!-- TIME BASED -->
            <div id="timeBlock" class="row mb-3" style="display:none;">
                <div class="col-md-6">
                    <label>Date</label>
                    <input asp-for="StartDate" type="date" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label>Time</label>
                    <input asp-for="TimeValue" type="time" class="form-control" />
                </div>
            </div>

            <!-- REASON -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label>Reason</label>
                    <textarea asp-for="Reason" class="form-control"></textarea>
                </div>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary px-4">
                    Submit Leave
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const category = document.getElementById("Category");
            const leaveType = document.getElementById("LeaveType");

            const leaveTypeBlock = document.getElementById("leaveTypeBlock");
            const fullMulti = document.getElementById("fullOrMultiDayBlock");
            const half = document.getElementById("halfDayBlock");
            const timeBlock = document.getElementById("timeBlock");
            const compOffBlock = document.getElementById("compOffDateBlock");

            category.addEventListener("change", () => {
                fullMulti.style.display = half.style.display = timeBlock.style.display = "none";
                leaveTypeBlock.style.display = compOffBlock.style.display = "none";

                if (category.value === "FullDay" || category.value === "MultiDay") {
                    fullMulti.style.display = "flex";
                    leaveTypeBlock.style.display = "flex";
                }
                else if (category.value === "HalfDay") {
                    half.style.display = "flex";
                }
                else if (category.value === "EarlyGoing" || category.value === "LateComing") {
                    timeBlock.style.display = "flex";
                }
            });

            leaveType.addEventListener("change", () => {
                compOffBlock.style.display =
                    leaveType.value === "coff" ? "flex" : "none";
            });
        });
    </script>

    <script>
        document.getElementById("leaveForm").addEventListener("submit", function (e) {

            const category = document.getElementById("Category").value;
            const leaveType = document.getElementById("LeaveType")?.value;
            const reason = document.querySelector("textarea[name='Reason']").value.trim();
            const start = document.querySelector("input[name='StartDate']")?.value;
            const end = document.querySelector("input[name='EndDate']")?.value;
            const time = document.querySelector("input[name='TimeValue']")?.value;
            const compOffDate = document.getElementById("CompOffDate")?.value;

            if (!category) { alert("Select Leave Category"); e.preventDefault(); return; }

            if ((category === "FullDay" || category === "MultiDay") && !leaveType) {
                alert("Select Leave Type"); e.preventDefault(); return;
            }

            if (leaveType === "coff" && !compOffDate) {
                alert("Select Comp-Off Earned Date"); e.preventDefault(); return;
            }

            if (!reason) { alert("Enter Reason"); e.preventDefault(); return; }

            if ((category === "FullDay" || category === "MultiDay") && (!start || !end)) {
                alert("Select Start & End Date"); e.preventDefault(); return;
            }

            if ((category === "EarlyGoing" || category === "LateComing") && !time) {
                alert("Select Time"); e.preventDefault(); return;
            }
        });
    </script>
}
 *@
@model HRMS.Models.Leave

@{
    ViewData["Title"] = "Apply for Leave";
   // Layout = "~/Views/Shared/_EmployeeLayout.cshtml";
    var role = ViewBag.UserRole as string;
    if (role == "HR")
    {
        Layout = "~/Views/Shared/_HrLayout.cshtml";
    }
    else if (role == "VP" || role == "GM" || role == "Director")
    {
        Layout = "~/Views/Shared/_HrLayout.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/_EmployeeLayout.cshtml";
    }
}

<style>
    .leave-title {
        font-size: 1.6rem;
        font-weight: 600;
    }

    .form-label {
        font-weight: 600;
    }

    .leave-card {
        border-radius: 16px;
        background: #fff;
        padding: 35px;
        max-width: 650px;
        margin: auto;
        box-shadow: 0 3px 18px rgba(0,0,0,0.1);
    }

    .total-box {
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 20px;
        font-size: 1.4rem;
        font-weight: 600;
        text-align: center;
    }
</style>

<div class="container">
    <div class="leave-card">

        <div class="leave-title">Apply for Leave</div>
        <hr />

        <form asp-action="Create" method="post" id="leaveForm">

            <!-- CATEGORY -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Leave Category</label>
                    <select asp-for="Category" id="Category" class="form-select">
                        <option value="">-- Select --</option>
                        <option value="FullDay">Full Day</option>
                        <option value="MultiDay">More Than 1 Day</option>
                        <option value="HalfDay">Half Day</option>
                        <option value="EarlyGoing">Early Going</option>
                        <option value="LateComing">Late Coming</option>
                    </select>
                </div>

                <div id="leaveTypeBlock" class="col-md-6" style="display:none;">
                    <label class="form-label">Leave Type</label>
                    <select asp-for="LeaveType" id="LeaveType" class="form-select">
                        <option value="">-- Select Leave Type --</option>
                        <option value="Sick">Sick</option>
                        <option value="Casual">Casual</option>
                        <option value="coff">Comp-Off</option>
                    </select>
                </div>
            </div>

            <!-- FULL / MULTI -->
            <div id="fullOrMultiDayBlock" class="row mb-3" style="display:none;">
                <div class="col-md-6">
                    <label>Start Date</label>
                    <input asp-for="StartDate" type="date" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label>End Date</label>
                    <input asp-for="EndDate" type="date" class="form-control" />
                </div>
            </div>

            <!-- HALF DAY -->
            <div id="halfDayBlock" class="row mb-3" style="display:none;">
                <div class="col-md-6">
                    <label>Date</label>
                    <input asp-for="StartDate" type="date" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label>Session</label>
                    <select asp-for="HalfDaySession" class="form-select">
                        <option value="">-- Select --</option>
                        <option value="FirstHalf">First Half</option>
                        <option value="SecondHalf">Second Half</option>
                    </select>
                </div>
            </div>

            <!-- TIME -->
            <div id="timeBlock" class="row mb-3" style="display:none;">
                <div class="col-md-6">
                    <label>Date</label>
                    <input asp-for="StartDate" type="date" class="form-control" />
                </div>
                <div class="col-md-6">
                    <label>Time</label>
                    <input asp-for="TimeValue" type="time" class="form-control" />
                </div>
            </div>

            <!-- REASON -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label>Reason</label>
                    <textarea asp-for="Reason" class="form-control"></textarea>
                </div>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary px-4">Submit Leave</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const category = document.getElementById("Category");
            const leaveType = document.getElementById("LeaveType");
            const leaveTypeBlock = document.getElementById("leaveTypeBlock");
            const fullMulti = document.getElementById("fullOrMultiDayBlock");
            const half = document.getElementById("halfDayBlock");
            const timeBlock = document.getElementById("timeBlock");

            category.addEventListener("change", () => {
                fullMulti.style.display = half.style.display = timeBlock.style.display = "none";
                leaveTypeBlock.style.display = "none";

                if (category.value === "FullDay" || category.value === "MultiDay") {
                    fullMulti.style.display = "flex";
                    leaveTypeBlock.style.display = "flex";
                }
                else if (category.value === "HalfDay") half.style.display = "flex";
                else if (category.value === "EarlyGoing" || category.value === "LateComing") timeBlock.style.display = "flex";
            });
        });
    </script>

    <script>
        document.getElementById("leaveForm").addEventListener("submit", function (e) {

            const category = document.getElementById("Category").value;
            const leaveType = document.getElementById("LeaveType").value;
            const reason = document.querySelector("textarea[name='Reason']").value.trim();
            const start = document.querySelector("input[name='StartDate']")?.value;
            const end = document.querySelector("input[name='EndDate']")?.value;
            const time = document.querySelector("input[name='TimeValue']")?.value;

            if (!category) { alert("Select Leave Category"); e.preventDefault(); return; }
            if ((category === "FullDay" || category === "MultiDay" || category ==="-- Select --") && !leaveType) { alert("Select Leave Type"); e.preventDefault(); return; }
            if (!reason) { alert("Enter Reason"); e.preventDefault(); return; }
            if ((category === "FullDay" || category === "MultiDay") && (!start || !end)) { alert("Select Start & End Date"); e.preventDefault(); return; }
            if ((category === "EarlyGoing" || category === "LateComing") && !time) { alert("Select Time"); e.preventDefault(); return; }
        });
    </script>
}
