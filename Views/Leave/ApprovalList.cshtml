

@model IEnumerable<HRMS.Models.Leave>
@{
    ViewData["Title"] = "Leave Approvals";
    Layout = "~/Views/Shared/_HRLayout.cshtml";
}

@{
    var userRole = ViewBag.UserRole as string;
}
<h3>Leave Approval</h3>
<hr />

<div id="approval-table-container">

<div class="row mt-4">
   
    @if (userRole == "Manager")
    {
        <div class="col-md-3">
            <div class="card p-3 shadow-sm">
                <h6>Pending Approvals</h6>
                <h3 class="text-primary">@ViewBag.ManagerPending</h3>
            </div>
        </div>
    }

    @if (userRole == "HR")
    {
        <div class="col-md-3">
            <div class="card p-3 shadow-sm">
                <h6>HR Pending</h6>
                <h3 class="text-warning">@ViewBag.HrPending</h3>
            </div>
        </div>
    }

    @if (userRole == "VP")
    {
        <div class="col-md-3">
            <div class="card p-3 shadow-sm">
                <h6>VP Pending</h6>
                <h3 class="text-info">@ViewBag.VpPending</h3>
            </div>
        </div>
    }

    @if (userRole == "Director")
    {
        <div class="col-md-3">
            <div class="card p-3 shadow-sm">
                <h6>Director Pending</h6>
                <h3 class="text-danger">@ViewBag.DirectorPending</h3>
            </div>
        </div>
    }

</div>

<table class="table table-bordered table-hover">
    <thead class="table-light">
        <tr>
            <th>Employee</th>
            <th>Category</th>
                <th>Leave Type</th>
            <th>Start</th>
            <th>End</th>
            <th>Days</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Remark</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        @foreach (var l in Model)
        {
                var empCode = l.Employee?.EmployeeCode ?? "-";
                var empName = l.Employee?.Name ?? "-";
            <tr>
                    <td>@($"{empCode} - {empName}")</td>
                <td>@l.Category</td>
                    <td>@l.LeaveType </td>
                    <td>@(l.StartDate.ToString("dd-MM-yyyy") ?? "N/A")</td>
                    <td>@(l.EndDate?.ToString("dd-MM-yyyy") ?? "N/A")</td>
                <td>@l.TotalDays</td>
                <td>@l.Reason</td>

                @* <td>
                    
                    HR: @l.HrStatus <br />
                    M: @l.ManagerStatus <br />
                    VP: @l.VpStatus <br />
                    Dir: @l.DirectorStatus
                </td> *@
                    <td>
                        @{
                            var empRole = l.Employee?.Role ?? "Employee";
                        }

                        @if (empRole == "Employee")
                        {
                            <div>
                                HR: @(l.HrStatus ?? "Pending") <br />
                                GM: @(l.ManagerStatus ?? "Pending") <br />
                                VP: @(l.VpStatus ?? "Pending")
                            </div>
                        }
                        else if (empRole == "HR")
                        {
                            <div>
                                GM: @(l.ManagerStatus ?? "Pending") <br />
                                VP: @(l.VpStatus ?? "Pending") <br />
                                Dir: @(l.DirectorStatus ?? "Pending")
                            </div>
                        }
                        else if (empRole == "GM")
                        {
                            <div>
                                
                                VP: @(l.VpStatus ?? "Pending") <br />
                                Dir: @(l.DirectorStatus ?? "Pending")
                            </div>
                        }
                        else if (empRole == "VP")
                        {
                              <div>
                                Dir: @(l.DirectorStatus ?? "Pending")
                                </div> 
                        }
                       @*  else if (empRole == "HR" || empRole == "Manager" || empRole == "VP")
                        {
                            <div>
                                HR: @(l.HrStatus ?? "Pending") <br />
                                GM: @(l.ManagerStatus ?? "Pending") <br />
                                VP: @(l.VpStatus ?? "Pending") <br />
                                Dir: @(l.DirectorStatus ?? "Pending")
                            </div>
                        } *@
                        else
                        {
                            <!-- Default fallback: show all -->
                            <div>
                                HR: @(l.HrStatus ?? "Pending") <br />
                                GM: @(l.ManagerStatus ?? "Pending") <br />
                                VP: @(l.VpStatus ?? "Pending") <br />
                                Dir: @(l.DirectorStatus ?? "Pending")
                            </div>
                        }
                    </td>


                <td>
                    <input class="form-control" id="remark-@l.Id" />
                </td>

                <td>
                    <a href="/Leave/@ViewBag.ApproveAction?id=@l.Id&approve=true&remark="
                       class="btn btn-success btn-sm">Approve</a>

                    <a href="/Leave/@ViewBag.ApproveAction?id=@l.Id&approve=false&remark="
                       class="btn btn-danger btn-sm">Reject</a>
                </td>
            </tr>
        }
    </tbody>
</table>
</div>  
<script >
        document.getElementById("sidebarToggle").addEventListener("click", function () {
        const sidebar = document.getElementById("sidebar-wrapper");

        if (window.innerWidth <= 768) {
            sidebar.classList.toggle("open");
        } else {
            sidebar.classList.toggle("collapsed");
        }
    });


      

</script>

