@model IEnumerable<dynamic>

<h2 class="text-primary mb-4">🎥 Gurukul Learning Portal</h2>

<div class="mb-3">
    <label>Filter by Category:</label>
    <select id="categorySelect" class="form-select w-auto d-inline-block">
        <option value="">All</option>
        @foreach (var c in ViewBag.Categories)
        {
            <option value="@c">@c</option>
        }
    </select>
</div>

<div class="mb-4">
    <label><strong>Your Progress:</strong></label>
    <div class="progress" style="height:25px;">
        <div class="progress-bar bg-success" style="width:@ViewBag.ProgressPercent%">
            @ViewBag.ProgressPercent%
        </div>
    </div>
</div>

<div class="row">
    @foreach (var v in Model)
    {
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title">@v.Title</h5>
                    <p class="text-muted">@v.Category</p>
                    <p>@v.Description</p>
                    <div class="ratio ratio-16x9 mb-3">
                        <iframe src="@v.VideoUrl" frameborder="0" allowfullscreen></iframe>
                    </div>

                    @if (v.IsCompleted)
                    {
                        <button class="btn btn-success w-100" disabled>Completed ✅</button>
                    }
                    else
                    {
                        <button class="btn btn-primary w-100 complete-btn" data-id="@v.Id">Mark as Completed</button>
                    }
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.getElementById('categorySelect').addEventListener('change', e => {
            const val = e.target.value;
            window.location = '/Gurukul/EmployeeGurukul?category=' + val;
        });

        document.querySelectorAll('.complete-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const id = btn.getAttribute('data-id');
                fetch(`/Gurukul/MarkCompleted?videoId=${id}`, { method: 'POST' })
                    .then(res => res.json())
                    .then(d => {
                        if (d.success) {
                            alert('✅ Marked as completed!');
                            location.reload();
                        }
                    });
            });
        });
    </script>
}
