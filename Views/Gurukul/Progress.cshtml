@model IEnumerable<HRMS.Models.GurukulProgress>

@{
    var video = (HRMS.Models.GurukulVideo?)ViewBag.Video;
    Layout = "_HRLayout";
}

<!-- ===================== STYLES ===================== -->
<style>
    .page-title {
        font-size: 28px;
        font-weight: 800;
        color: #1a237e;
        margin-bottom: 25px;
    }

    .filter-card {
        background: #ffffff;
        border-radius: 14px;
        padding: 20px;
        box-shadow: 0 5px 18px rgba(0,0,0,0.07);
        border: 1px solid #e3e6f3;
        margin-bottom: 25px;
    }

    .filter-title {
        font-weight: 700;
        font-size: 17px;
        margin-bottom: 12px;
        color: #283593;
    }

    .table-card {
        background: #ffffff;
        border-radius: 14px;
        padding: 0;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        border: 1px solid #e0e4f5;
    }

    table thead {
        background: #eef1ff;
        color: #1a237e;
        font-weight: 700;
    }

    table tbody tr:hover {
        background: #f7f8ff;
        transition: 0.18s ease;
    }

    td {
        font-size: 15px;
        padding: 14px;
        vertical-align: middle;
    }

    th {
        padding: 14px;
    }

    .badge-success {
        background: #43a047 !important;
        padding: 7px 14px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
    }

    .badge-warning {
        background: #fb8c00 !important;
        padding: 7px 14px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        color: #fff !important;
    }

    .btn-primary {
        background: #3949ab !important;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        padding: 8px 18px;
    }

    .btn-secondary {
        border-radius: 8px;
        padding: 8px 18px;
        font-weight: 600;
    }
</style>


<!-- ===================== PAGE TITLE ===================== -->
<h2 class="page-title">📊 Progress Report – @video?.Title</h2>


<!-- ===================== FILTER SECTION ===================== -->
<div class="filter-card">
    <div class="filter-title">🔍 Filter Results</div>

    <form method="get" asp-action="Progress">
        <input type="hidden" name="id" value="@video?.Id" />

        <div class="row">

            <!-- STATUS FILTER -->
            <div class="col-md-3 mb-3">
                <label class="fw-semibold">Status</label>
                <select name="status" class="form-control">

                    @if ((string)ViewBag.SelectedStatus == "" || ViewBag.SelectedStatus == null)
                    {
                        <option value="" selected>All</option>
                    }
                    else
                    {
                        <option value="">All</option>
                    }

                    @if ((string)ViewBag.SelectedStatus == "completed")
                    {
                        <option value="completed" selected>Completed</option>
                    }
                    else
                    {
                        <option value="completed">Completed</option>
                    }

                    @if ((string)ViewBag.SelectedStatus == "pending")
                    {
                        <option value="pending" selected>Pending</option>
                    }
                    else
                    {
                        <option value="pending">Pending</option>
                    }

                </select>
            </div>

            <!-- DEPARTMENT FILTER -->
            <!-- DEPARTMENT FILTER -->
            <div class="col-md-3 mb-3">
                <label class="fw-semibold">Department</label>
                <select name="department" class="form-control">
                    <option value="ALL" selected="@("ALL" == (string)ViewBag.SelectedDepartment)">All Departments</option>

                    @foreach (var d in ViewBag.DepartmentList as List<string>)
                    {
                        <option value="@d" selected="@(ViewBag.SelectedDepartment == d)">
                            @d
                        </option>
                    }
                </select>
            </div>


            <!-- SEARCH FILTER -->
            <div class="col-md-3 mb-3">
                <label class="fw-semibold">Search Employee</label>
                <input type="text"
                       name="search"
                       value="@ViewBag.Search"
                       class="form-control"
                       placeholder="Employee name..." />
            </div>

            <!-- BUTTONS -->
            <div class="col-md-3 d-flex align-items-end mb-3">
                <button type="submit" class="btn btn-primary me-2">Apply Filter</button>
                <a asp-action="Progress"
                   asp-route-id="@video?.Id"
                   class="btn btn-secondary">Clear</a>
            </div>

        </div>
    </form>
</div>


<!-- ===================== TABLE SECTION ===================== -->
<div class="table-card">
    <table class="table table-hover mb-0">
        <thead>
            <tr>
                <th>Employee</th>
                <th>Department</th>
                <th>Status</th>
                <th>Completed On</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var p in Model)
            {
                <tr>
                    <td><strong>@p.Employee?.Name</strong></td>

                    <td>@p.Employee?.Department</td>

                    <td>
                        @if (p.IsCompleted)
                        {
                            <span class="badge badge-success">Completed</span>
                        }
                        else
                        {
                            <span class="badge badge-warning">Pending</span>
                        }
                    </td>

                    <td>
                        @if (p.CompletedOn != null)
                        {
                            @p.CompletedOn.Value.ToLocalTime().ToString("dd-MM-yyyy hh:mm tt")
                        }
                        else
                        {
                            <span class="text-muted">—</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
